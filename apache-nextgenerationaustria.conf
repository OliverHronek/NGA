<VirtualHost *:80>
    ServerName nextgenerationaustria.at
    DocumentRoot /var/www/html/nextgenerationaustria.at
    RewriteEngine On
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName nextgenerationaustria.at
    DocumentRoot /var/www/html/nextgenerationaustria.at
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/nextgenerationaustria.at/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/nextgenerationaustria.at/privkey.pem

    # MIME-Types f√ºr Flutter
    AddType application/javascript .js
    AddType application/wasm .wasm
    AddType application/json .json

    # API PROXY - Node.js Backend
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    ProxyPass /health http://localhost:3000/health
    ProxyPassReverse /health http://localhost:3000/health

    # Root-Verzeichnis (Landing Page)
    <Directory /var/www/html/nextgenerationaustria.at>
        Options -Indexes
        AllowOverride All
        Require all granted
        DirectoryIndex index.html
    </Directory>

    # Flutter App unter /app/
    <Directory /var/www/html/nextgenerationaustria.at/app>
        Options -Indexes
        AllowOverride All
        Require all granted
        DirectoryIndex index.html

        # Flutter SPA Routing
        RewriteEngine On
        RewriteBase /app/
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /app/index.html [L]
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/nextgenerationaustria_error.log
    CustomLog ${APACHE_LOG_DIR}/nextgenerationaustria_access.log combined
</VirtualHost>
